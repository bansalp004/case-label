<?php session_start(); ?>
<!DOCTYPE html>
<html>
<head>
    <title>Doctor Case Review</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

</head>
<body>
<div class="container">

    <div class="row" style="margin-top: 50px !important;">


    </div>

    <div class="row">

        <div class="col-md-7">
            <label for="caseArea">Please Review this Case</label>
            <textarea class="form-control rounded-0" id="caseArea" rows="10" column="223"></textarea>
        </div>

        <div class="col-md-5">

            <label for="exampleFormControlTextarea1">Select Condition</label>

            <select id="condition" name="conditions" class="selectpicker show-tick" > </select>
            



            <button type="button" id="btnNextCase" class="btn btn-primary mb-2" style="margin-top: 200px !important;" >Next Case</button>

        </div>

    </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

<script type="text/javascript">


    let dropdown = $('#condition');
    dropdown.empty();
    dropdown.prop('selectedIndex', 0);

    const url = 'http://localhost:8080/conditions';
    
    $.getJSON(url, function (data) {
        $.each(data, function (key, entry) {
            dropdown.append($('<option></option>').attr('value', entry.code).text(entry.name));
        })
    });

    //fill text area
    var loggedInUser = localStorage.getItem("loggedInUser");
    console.log("loggedInUser :" + loggedInUser)


    const urlFetchCase = 'http://localhost:8080/case?userName='+loggedInUser;

    $.getJSON(urlFetchCase, function (data) {
        $('#caseArea').val(data.caseData);
    });

    
    
    //button click
    $("btnNextCase").click(function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/pages/test/",
            data: {
                id: $(this).val(), // < note use of 'this' here
                access_token: $("#access_token").val()
            },
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert('error');
            }
        });
    });

</script>


</html>






